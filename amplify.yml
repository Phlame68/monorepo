version: 1
applications:
  - appRoot: apps/dashboard
    api:
      phases:
        build:
          commands:
            - cd ../..
            - yarn install --ci
            - yarn nx run api:build --prod --skip-nx-cache
            - cp node_modules apps/api
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
    auth:
      phases:
        build:
          commands:
            - cd ../..
            - yarn install --ci
            - yarn nx run auth:build --prod --skip-nx-cache
            - cp node_modules apps/auth
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*

    dashboard:
      phases:
        build:
          commands:
            - cd ../..
            - yarn install --ci
            - yarn nx run dashboard:build --prod --skip-nx-cache
            - cp node_modules apps/dashboard
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
